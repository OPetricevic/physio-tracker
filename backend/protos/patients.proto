syntax = "proto3";

package patients.v1;

import "google/protobuf/wrappers.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/OPetricevic/physio-tracker/backend/golang/patients;patients";

// Patient represents a person under care.
message Patient {
  string uuid = 1; // required
  string doctor_uuid = 2; // required
  string first_name = 3; // required
  string last_name = 4; // required
  google.protobuf.StringValue phone = 5;
  google.protobuf.StringValue address = 6;
  google.protobuf.StringValue date_of_birth = 7;
  google.protobuf.StringValue sex = 8;
  google.protobuf.Timestamp created_at = 9; // set by service
  google.protobuf.Timestamp updated_at = 10; // nullable
}

// Anamnesis represents a single visit/session note.
message Anamnesis {
  string uuid = 1;
  string patient_uuid = 2;
  string note = 3;
  google.protobuf.StringValue diagnosis = 4;
  google.protobuf.StringValue therapy = 5;
  google.protobuf.StringValue other_info = 6;
  google.protobuf.StringValue visit_reason = 7;
  google.protobuf.Timestamp created_at = 8;
}

message CreatePatientRequest {
  string doctor_uuid = 1;
  string first_name = 2;
  string last_name = 3;
  google.protobuf.StringValue phone = 4;
  google.protobuf.StringValue address = 5;
  google.protobuf.StringValue date_of_birth = 6;
  google.protobuf.StringValue sex = 7;
}

message PatientResponse {
  Patient patient = 1;
}

message ListPatientsRequest {
  string query = 1;
}

message ListPatientsResponse {
  repeated Patient patients = 1;
}

message UpdatePatientRequest {
  string uuid = 1;
  string doctor_uuid = 2;
  string first_name = 3;
  string last_name = 4;
  google.protobuf.StringValue phone = 5;
  google.protobuf.StringValue address = 6;
  google.protobuf.StringValue date_of_birth = 7;
  google.protobuf.StringValue sex = 8;
}

message DeletePatientRequest {
  string uuid = 1;
}

message AddAnamnesisRequest {
  string patient_uuid = 1;
  string note = 2;
  google.protobuf.StringValue diagnosis = 3;
  google.protobuf.StringValue therapy = 4;
  google.protobuf.StringValue other_info = 5;
  google.protobuf.StringValue visit_reason = 6;
}

message AnamnesisResponse {
  Anamnesis anamnesis = 1;
}

message ListAnamnesesRequest {
  string patient_uuid = 1;
  int32 page = 2;
  int32 page_size = 3;
}

message ListAnamnesesResponse {
  repeated Anamnesis anamneses = 1;
}

message GeneratePdfRequest {
  string patient_uuid = 1;
  string anamnesis_uuid = 2;
  repeated string include_visit_uuids = 3; // visits to include (newest first in response)
}

message PdfResponse {
  bytes data = 1;
}

message BackupPatientRequest {
  string patient_uuid = 1;
}

message BackupResponse {
  bytes data = 1;
}

service PatientsService {
  rpc CreatePatient(CreatePatientRequest) returns (PatientResponse);
  rpc UpdatePatient(UpdatePatientRequest) returns (PatientResponse);
  rpc DeletePatient(DeletePatientRequest) returns (PatientResponse);
  rpc ListPatients(ListPatientsRequest) returns (ListPatientsResponse);

  rpc AddAnamnesis(AddAnamnesisRequest) returns (AnamnesisResponse);
  rpc ListAnamneses(ListAnamnesesRequest) returns (ListAnamnesesResponse);
  rpc GenerateAnamnesisPdf(GeneratePdfRequest) returns (PdfResponse);
  rpc BackupPatient(BackupPatientRequest) returns (BackupResponse);
}
